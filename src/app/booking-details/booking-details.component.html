<div class="booking-details-container" *ngIf="booking">
  <!-- Header -->
  <div class="details-header text-center">
    <h3>üìÑ Booking Invoice</h3>
    <p>
      <strong>ID:</strong> {{ booking.id }} | 
      <strong>Type:</strong> {{ booking.mode }} | 
      <strong>Time:</strong> {{ booking.time }}
    </p>
  </div>

  <!-- Customer & Address -->
  <div class="row customer-info">
    <div class="col-md-6 col-12">
      <h6>üë§ Booked By</h6>
      <p><strong>Name:</strong> {{ booking.customer.name }}</p>
      <p><strong>Email:</strong> {{ booking.customer.email }}</p>
      <p><strong>Mobile:</strong> {{ booking.customer.mobile }}</p>
    </div>

    <div class="col-md-6 col-12">
      <h6>üìç Deliver To</h6>
      <p><strong>Address:</strong> {{ booking.address.line }}</p>
      <p><strong>Landmark:</strong> {{ booking.address.landmark }}</p>
      <p><strong>City:</strong> {{ booking.address.city }}</p>
      <p><strong>Pincode:</strong> {{ booking.address.pincode }}</p>
    </div>
  </div>

  <!-- Products -->
  <h6 class="mt-3">üõí Booked Products</h6>
  <div class="table-responsive">
    <table class="table table-bordered align-middle text-center">
      <thead>
        <tr>
          <th>Image</th>
          <th>Product</th>
          <th>MRP</th>
          <th>Color</th>
          <th>Size</th>
          <th>{{ booking.mode === 'Retail' ? 'Retail Price' : 'Wholesale Price' }}</th>
          <th>Discount</th>
          <th>Qty</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of booking.products">
          <td><img [src]="p.image" alt="product" class="product-img" /></td>
          <td>{{ p.name }}</td>
          <td>{{ p.price | currency : 'INR' }}</td>
          <td>{{ p.color }}</td>
          <td>{{ p.size }}</td>
          <td>{{ booking.mode === 'Retail' ? (p.retailPrice | currency:'INR') : (p.wholesalePrice | currency:'INR') }}</td>
          <td>{{ p.discount | currency:'INR' }}</td>
          <td>{{ p.quantity }}</td>
          <td>{{ p.totalPrice | currency:'INR' }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Payments -->
  <h6 class="mt-3">üí≥ Payment Details</h6>
  <div class="table-responsive">
    <table class="table table-bordered align-middle text-center">
      <thead>
        <tr>
          <th>Txn ID</th>
          <th>Amount</th>
          <th>Payment Time</th>
          <th>Mode</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let pay of booking.payments">
          <td>{{ pay.transaction_id }}</td>
          <td>{{ pay.amount | currency : 'INR' }}</td>
          <td>{{ pay.payment_time }}</td>
          <td>{{ booking?.bookingMode }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Payment Proof -->
  <div class="payment-proof text-center mt-3" *ngIf="booking?.paymentImage?.link">
    <h6>üì∑ Payment Proof</h6>
    <img [src]="booking.paymentImage.link" alt="Payment Proof"
         class="payment-thumb"
         (click)="viewImage(booking.paymentImage.link)" />

    <div class="btn-group mt-2">
      <button class="btn btn-primary btn-sm" (click)="viewImage(booking.paymentImage.link)">üëÅ View</button>
      <a [href]="booking.paymentImage.link" [download]="booking.paymentImage.name" class="btn btn-success btn-sm">‚¨á Download</a>
    </div>
  </div>

  <!-- Totals -->
  <div class="totals text-end mt-3">
    <h5>Total: {{ booking.totalAmount | currency:'INR' }}</h5>
    <h6>Paid: {{ booking.paidAmount | currency:'INR' }}</h6>
    <h6>Mode: {{ booking.paymentType }}</h6>
  </div>

  <!-- Status Update -->
  <div class="status-update text-center mt-4">
    <label class="fw-bold">Update Status</label>
    <select class="form-select status-select"
            [ngModel]="booking.status"
            (ngModelChange)="updateBookingStatus($event)">
      <option *ngFor="let s of bookingStatusEnum" [value]="s">{{ s }}</option>
    </select>
  </div>
</div>

<!-- üî• Full Image Preview Modal -->
<div class="image-modal" *ngIf="showImageModal">
  <div class="image-modal-content">
    <span class="close-btn" (click)="closeImageModal()">&times;</span>
    <img [src]="previewImage" alt="Full Payment Proof" class="full-image" />
  </div>
</div>
